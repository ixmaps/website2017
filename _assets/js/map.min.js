var myIp="",myCity="",myCountry="",myIsp="",myAsn="",myLat="",myLong="",autocompletes={country:[],region:[],city:[],zipCode:[],ISP:[],submitter:[]},init=function(){getMyLocation(),setUpGMaps(),setDefaultMapSettings(),getLayers(),populateLayersContainer(),getPrivacyReport(),0==initMode?jQuery(".opening.modal").modal("show"):1==initMode?submitCustomQuery(trIdFilter):2==initMode&&processPostedData(postedData),createASRow("first"),setUpClickHandlers(),_.each(autocompletes,function(a,b){loadAutocompleteData(b)}),autocompletes.nsa=["yes","no"],bindAutocomplete(jQuery('.bs-input[data-constraint="NSA"]'),"nsa")},getMyLocation=function(){jQuery("#my-location-status").html("Loading location...");var a={action:"getMyLocation"};jQuery.ajax(url_base+"/application/controller/mygeoip.php",{type:"post",data:a,success:function(a){console.log("getMyLocation data loaded ");var b=jQuery.parseJSON(a);console.log(b),setMyLocationData(b)},error:function(a){console.log("Error! getMyLocation data can't be loaded",a)}})},setMyLocationData=function(a){jQuery("#my-location-status").html(""),myIp=a.myIp,myCity=a.myCity,myCountry=a.myCountry,myIsp=a.myIsp,myAsn=a.myAsn,myLat=a.myLat,myLong=a.myLong,jQuery(".userloc-ip").text(myIp),jQuery(".userloc-city").val(myCity),jQuery(".userloc-country").val(myCountry),jQuery(".userloc-isp").text(myIsp),jQuery(".userloc-asn").text(myAsn)},setUpClickHandlers=function(){jQuery("#search-header .qs-last-contributed-btn").click(function(){constructLastContributed()}),jQuery("#search-header .qs-via-nsa-city-btn").click(function(){constructViaNSA()}),jQuery("#search-header .qs-via-boomerangs-btn").click(function(){constructBoomerangs()}),jQuery("#search-header .qs-from-my-isp-btn").click(function(){constructFromMyIsp()}),jQuery("#search-header .qs-from-my-cty-btn").click(function(){constructFromMyCity()}),jQuery("#search-header .qs-from-my-country-btn").click(function(){constructFromMyCountry()}),jQuery("#bs-submit-btn").click(function(){constructBS()}),jQuery("#as-submit-btn").click(function(){constructAS()}),jQuery("#as-clear-btn").click(function(){jQuery(".advanced.input-holder").remove(),createASRow("first")}),jQuery("#myloc-submit-btn").click(function(){submitUserLocObject(),jQuery(".opening.modal").modal("hide")}),jQuery(".map-settings-button").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#map-help-btn").click(function(){jQuery(".map-help.modal").modal("show")}),jQuery("#remove-all-trs-btn").click(function(){removeAllTrs()}),jQuery("#add-all-trs-btn").click(function(){addAllTrs()}),jQuery("#cancel-query").click(function(){cancelQuery(),hideLoader()}),jQuery("#filter-results-summary-container").click(function(){jQuery("#filter-results-summary").toggle()}),jQuery("#tr-details-close-btn").click(function(){removeTr(),jQuery(".traceroutes.modal").modal("hide")}),jQuery("#settings-close-btn").click(function(){removeTr(),jQuery(".settings.modal").modal("hide")}),jQuery("#flagging-close-btn").click(function(){removeTr(),jQuery(".flagging.modal").modal("hide")}),jQuery("#carrier-close-btn").click(function(){removeTr(),jQuery(".carrier.modal").modal("hide")}),jQuery("#opening-close-btn").click(function(){removeTr(),jQuery(".opening.modal").modal("hide")}),jQuery("#map-help-close-btn").click(function(){jQuery(".map-help.modal").modal("hide")}),jQuery(".top.menu .item").on("click",function(){jQuery(".active").removeClass("active"),jQuery(this).addClass("active"),jQuery(".tab").hide(),jQuery("#"+jQuery(this).attr("id")+"-container").show()}),jQuery(".as-link").on("click",function(){jQuery(".active").removeClass("active"),jQuery("#as-tab").addClass("active"),jQuery(".tab").hide(),jQuery("#as-tab-container").show()}),jQuery("table").tablesorter({}),jQuery(".ui.rating").rating("disable"),jQuery("#settings-modal").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#traceroutes-modal").click(function(){jQuery(".traceroutes.modal").modal("show")}),jQuery("#router-modal").click(function(){jQuery(".router.modal").modal("show")}),jQuery("#carrier-modal").click(function(){jQuery(".carrier.modal").modal("show")}),jQuery("#opening-modal").click(function(){jQuery("#opening-modal-div").modal("show"),jQuery(".opening.modal").modal("show")}),jQuery("#flagging-modal").click(function(){jQuery(".flagging.modal").modal("show")}),jQuery("a.from.basic-srch-itm").popup({popup:".from.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.via").popup({popup:".via.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.to").popup({popup:".to.popup",inline:!0,on:"click"}),jQuery(".ui.sidebar").sidebar({context:jQuery(".map-holder"),dimPage:!1,closable:!1}).sidebar("setting","transition","overlay","toggle").sidebar("attach events",".map-holder .layers-toggle .toggle.button"),jQuery(".ui.accordion").accordion(),jQuery(".toggle.button").state({})},renderTrResultTable=function(a){},showLoader=function(){jQuery("#loader").show()},hideLoader=function(){jQuery("#loader").hide()},cancelQuery=function(){ajaxObj&&4!=ajaxObj.readystate&&(ajaxObj.abort(),console.log("Query submission has been canceled."))},setTableSorters=function(){console.log("Sorting TR Tables"),jQuery("#traceroutes-table").tablesorter({sortList:[[0,2]]})},loadAutocompleteData=function(a){var b={action:"loadAutoCompleteData",field:a,keyword:" "};jQuery.ajax(url_base+"/application/controller/autocomplete.php",{type:"post",data:b,success:function(b){console.log("Autocomplete data loaded: "+a);var c=jQuery.parseJSON(b);autocompletes[a]=_.reject(c,_.isNull),bindAutocomplete(jQuery('.bs-input[data-constraint="'+a+'"]'),a),"country"===a&&bindAutocomplete(jQuery(".userloc-country"),a),"city"===a&&bindAutocomplete(jQuery(".userloc-city"),a)},error:function(a){console.error("Autocomplete data can't be loaded",a)}})},bindAutocomplete=function(a,b){autocompletes[b]?jQuery(a).autocomplete({source:autocompletes[b]}):console.log("Cannot bind autocomplete data")};