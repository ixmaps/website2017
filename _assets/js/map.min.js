var myIp="",myCity="",myCountry="",myCountryName="",myIsp="",myAsn="",myLat="",myLong="",init=function(){getMyLocation(),setUpGMaps(),setDefaultMapSettings(),getPrivacyReport(),0==initMode?(jQuery(".opening.modal").modal("show"),jQuery(".sidebar.vertical.legend").addClass("overlay visible animating")):1==initMode?submitUrlTrId(trIdFilter):2==initMode&&processPostedData(postedData),createASRow("first"),setUpClickHandlers(),_.each(autocompletes,function(a,b){loadAutocompleteData(b)}),autocompletes.nsa=["yes","no"],bindAutocomplete(jQuery('.bs-input[data-constraint="NSA"]'),"nsa"),populateTooltips()},getMyLocation=function(){jQuery("#my-location-status").html("Loading location...");var a={action:"getMyLocation"};jQuery.ajax(config.url_base+"/application/controller/mygeoip.php",{type:"post",data:a,success:function(a){console.log("getMyLocation data loaded");var b=jQuery.parseJSON(a);setMyLocationData(b)},error:function(a){console.log("Error! getMyLocation data can't be loaded",a.responseText)}})},setMyLocationData=function(a){jQuery("#my-location-status").html(""),myIp=a.myIp,myCity=a.myCity,myCountry=a.myCountry,myCountryName=a.myCountryName,myIsp=a.myIsp,myAsn=a.myAsn,myLat=a.myLat,myLong=a.myLong,resetUserLocQueryOptions(),//!!
jQuery("#myloc-submit-btn").unbind("click"),buildInitialMapEntryQuery("first")},setUpClickHandlers=function(){jQuery("#search-header .qs-last-contributed-btn").click(function(){constructLastContributed()}),jQuery("#search-header .qs-via-nsa-city-btn").click(function(){constructViaNSACity()}),jQuery("#search-header .qs-via-boomerangs-btn").click(function(){constructBoomerangs()}),jQuery("#search-header .qs-from-my-isp-btn").click(function(){constructFromMyIsp()}),jQuery("#search-header .qs-from-my-cty-btn").click(function(){constructFromMyCity()}),jQuery("#search-header .qs-from-my-country-btn").click(function(){constructFromMyCountry()}),jQuery("#bs-submit-btn").click(function(){constructBS()}),jQuery("#as-submit-btn").click(function(){constructAS()}),jQuery("#as-clear-btn").click(function(){jQuery(".advanced.input-holder").remove(),createASRow("first")}),jQuery("#myloc-submit-btn").click(function(){submitUserLocObject(),jQuery(".opening.modal").modal("hide")}),jQuery("#myloc-skip-btn").click(function(){jQuery(".opening.modal").modal("hide")}),jQuery("#myloc-contribute-btn").click(function(){jQuery(".opening.modal").modal("hide"),window.location="/contribute.php"}),jQuery("#myloc-reload-btn").click(function(){jQuery("#myloc-reload-btn").removeClass("blue"),jQuery("#myloc-submit-btn").unbind("click"),buildInitialMapEntryQuery("")}),jQuery(".map-settings-button").click(function(a){jQuery(".settings.modal").modal("show"),setTimeout(function(){jQuery(".map-settings-button").removeClass("active")},100)}),jQuery("#tot-results").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#map-help-btn").click(function(){jQuery(".map-help.modal").modal("show")}),jQuery(".more-details-btn").click(function(a){jQuery(".traceroute-container-more-details").hasClass("hidden")?(jQuery(".traceroute-container").addClass("hidden"),jQuery(".traceroute-container-more-details").removeClass("hidden"),jQuery(".more-details").removeClass("hidden"),jQuery(".more-details-btn").text("Less details...")):(jQuery(".traceroute-container").removeClass("hidden"),jQuery(".traceroute-container-more-details").addClass("hidden"),jQuery(".more-details").addClass("hidden"),jQuery(".more-details-btn").text("More details..."))}),jQuery(".userloc-submitter").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".userloc-city").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".user-loc-chkbox").change(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery(".userloc-city .userloc-submitter").focus(function(){jQuery("#myloc-reload-btn").addClass("blue")}),jQuery("#remove-all-trs-btn").click(function(){removeAllTrs()}),jQuery("#add-all-trs-btn").click(function(){addAllTrs()}),jQuery("#cancel-query").click(function(){cancelQuery(),hideLoader()}),jQuery("#tr-details-close-btn").click(function(){removeTr(),jQuery(".traceroutes.modal").modal("hide")}),jQuery("#settings-close-btn").click(function(){removeTr(),jQuery(".settings.modal").modal("hide")}),jQuery("#flagging-close-btn").click(function(){removeTr(),jQuery(".flagging.modal").modal("hide")}),jQuery("#carrier-close-btn").click(function(){removeTr(),jQuery(".carrier.modal").modal("hide")}),jQuery("#opening-close-btn").click(function(){removeTr(),jQuery(".opening.modal").modal("hide")}),jQuery("#map-help-close-btn").click(function(){jQuery(".map-help.modal").modal("hide")}),jQuery(".top.menu .item").on("click",function(){jQuery(".active").removeClass("active"),jQuery(this).addClass("active"),jQuery(".tab").hide(),jQuery("#"+jQuery(this).attr("id")+"-container").show()}),jQuery(".bs-link").on("click",function(){jQuery(".active").removeClass("active"),jQuery("#bs-tab").addClass("active"),jQuery(".tab").hide(),jQuery("#bs-tab-container").show()}),jQuery(".as-link").on("click",function(){jQuery(".active").removeClass("active"),jQuery("#as-tab").addClass("active"),jQuery(".tab").hide(),jQuery("#as-tab-container").show()}),jQuery(".ui.rating").rating("disable"),jQuery("#settings-modal").click(function(){jQuery(".settings.modal").modal("show")}),jQuery("#traceroutes-modal").click(function(){jQuery(".traceroutes.modal").modal("show")}),jQuery("#router-modal").click(function(){jQuery(".router.modal").modal("show")}),jQuery("#carrier-modal").click(function(){jQuery(".carrier.modal").modal("show")}),jQuery("#opening-modal").click(function(){jQuery("#opening-modal-div").modal("show"),jQuery(".opening.modal").modal("show")}),jQuery("#flagging-modal").click(function(){jQuery(".flagging.modal").modal("show")}),jQuery("a.from.basic-srch-itm").popup({popup:".from.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.via").popup({popup:".via.popup",inline:!0,on:"click"}),jQuery(".basic-srch-itm.to").popup({popup:".to.popup",inline:!0,on:"click"}),jQuery(".ui.sidebar").sidebar({context:jQuery(".map-holder"),dimPage:!1,closable:!1}).sidebar("setting","transition","overlay","toggle").sidebar("attach events",".map-holder .layers-toggle"),jQuery(".ui.accordion").accordion(),jQuery(".toggle.button").state({})},showLoader=function(){jQuery("#loader").show()},hideLoader=function(){jQuery("#loader").hide()},cancelQuery=function(){ajaxObj&&4!=ajaxObj.readystate&&(ajaxObj.abort(),console.log("Query submission has been canceled."))},loadAutocompleteData=function(a){var b={action:"loadAutoCompleteData",field:a};jQuery.ajax(config.url_base+"/application/controller/autocomplete.php",{type:"post",data:b,success:function(b){var c=jQuery.parseJSON(b);autocompletes[a]=_.reject(c,_.isNull),bindAutocomplete(jQuery('.bs-input[data-constraint="'+a+'"]'),a),"submitter"===a&&(bindAutocomplete(jQuery(".userloc-submitter"),a),bindAutocomplete(jQuery(".constraint-input input"),a)),"country"===a&&bindAutocomplete(jQuery(".userloc-country"),a),"city"===a&&bindAutocomplete(jQuery(".userloc-city"),a)},error:function(a){console.error("Autocomplete data can't be loaded",a)}})},bindAutocomplete=function(a,b){autocompletes[b]?jQuery(a).autocomplete({source:autocompletes[b]}):(console.log("No autocomplete data for this type, unbinding..."),jQuery(a).autocomplete({source:[]}))},populateTooltips=function(){_.each(tooltips,function(a){jQuery(a.element).attr("title",a.text)})};