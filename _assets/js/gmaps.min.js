var privacyRepUrl=config.url_base+"/transparency.php",ixmapsDataJson={},allowMultipleTrs=!1,allowRecenter=!0,showOriginMarker=!0,showTerminationMarker=!0,showNsa=!1,showHotel=!1,showGoogle=!1,showUc=!1,showIXca=!1,showCiraIPT=!1,showAtt=!1,showVerizon=!1,showGooglePublicPeer=!1,showGoogleTO=!1,routeMarkers=[],showDynamicLegend=!0,excludeCoord0=!0,excludeCoordGen=!0,excludeImpDist=!1,excludeReservedAS=!0,excludeUserFlagged=!0,impDistLog="",skippedRouterNum=new Array(0,0,0,0),trRouterCount=0,trRouterAdded=0,trRenderSpeed=50,trRenderStop=!1,map=null,activeTrId=null,activeTrObj=null,trCollection=[],trOcollection=[],trsAddedToMap=[],ipCollection=new Object,cHotelData,gmObjects=[],infowindow=null,infowindowRoute=null,infowindowTimeout,gmNsa=[],gmHotel=[],gmGoogle=[],gmUc=[],gmIXca=[],gmCiraIPT=[],gmAtt=[],gmVerizon=[],gmGooglePublicPeer=[],gmGoogleTO=[],totTRs=0,activeCarriers=new Object,coordCollected=[],coordCollectedObj=[],addMarkerInLastHop=!0,addMarkerInDesination=!0,privacyData,setUpGMaps=function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://maps.google.com/maps/api/js?v=3&libraries=geometry&key="+config.gmaps.key+"&callback=initializeMap",document.body.appendChild(a)},initializeMap=function(){var a=new google.maps.LatLng(43.3,-101.79),b={scrollwheel:!1,navigationControl:!0,mapTypeControl:!0,scaleControl:!0,draggable:!0,zoom:3,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),b),0==$("#layers-container a").length&&(getLayers(),populateLayersContainer())},renderCollectedCoords=function(){jQuery.each(coordCollected,function(a,b){var c=new google.maps.Polyline({path:coordCollected,strokeOpacity:1,strokeColor:"#FF0000",strokeWeight:5});coordCollectedObj.push(c),c.setMap(map)})},loadMapData=function(){setTimeout(function(){initializeMap(),showThisTr(_.last(_.keys(ixmapsDataJson))),renderLayers(),console.log("IXmaps geographic data downloaded! [TRs: "+totTRs+"]")},300),removeAllTrs(),jQuery("#options-btn").removeClass("hidden"),jQuery("#layers-btn").removeClass("hidden"),jQuery("#help-btn").removeClass("hidden")},showTotalTrInfo=function(){if(showDynamicLegend){var a="";a+='<table id="carrier-table" style="width: 100%;" class="tr-list-result ui tablesorter selectable celled compact table">',a+="<thead><tr>",a+='<th title="Telecommunications service provider, i.e. a local internet service provider, or longhaul ‘backbone carrier.’ Click on highlighted carriers to see more about them.">Carrier</th>',a+='<th class="nat-header">Nat.</th>',a+='<th class="routers-header" title="Number of routers mapped belonging to the carrier.">Rts.</th>',a+='<th class="score-header" title="Number of stars for data privacy transparency awarded to the carrier in the latest privacy transparency report. See Transparency page.">Transparency</th>',a+="</tr></thead><tbody>",jQuery.each(activeCarriers,function(b,c){var d=privacyData.scores[b],e=-1,f="",g="";void 0===d||(e=getPrivacyScore(b),f="",f=renderPrivacyScore(e)),a+='<tr class="carrier" title="Click on the carrier name to show more details about its rating on each 10 criteria star criteria">',g=e>=0?'<a class="link" href="javascript:viewPrivacy('+b+')">'+c[1]+"</a>":"<span>"+c[1]+"</span>";var h=getAsnColour(b).replace(/rgb/i,"rgba").replace(/\)/i,",0.7)");if(a+='<td><div class="carrier-colour" style="background-color: '+h+'"></div>'+g+"</td>",null!=c[2]){var i=c[2].toLowerCase();a+='<td class=""><i class="'+i+' flag"></i>'+c[2]+"</td>"}else a+='<td class=""></td>';a+='<td class="centered-table-cell">'+c[0]+"</td>",a+='<td class="star-col">'+f+"</td>",a+="</tr>"}),a+="</tbody></table>",jQuery("#carriers-results-table").html(a),0!=trCollection.length&&jQuery("#carrier-table").tablesorter({sortList:[[2,1]]})}jQuery("#tr-count").text(trsAddedToMap.length)},showThisTr=function(a){allowMultipleTrs||removeAllTrs(),renderTr(a),showTotalTrInfo()},stopRender=function(){trRenderStop?(jQuery("#map-render-stop-play").val("Stop"),trRenderStop=!1):(jQuery("#map-render-stop-play").val("Play"),trRenderStop=!0),console.log("stopRender",trRenderStop)},checkIfStopped=function(){return console.log("... Checking trRenderStop"),trRenderStop},addAllTrs=function(){removeAllTrs(),jQuery("#map-status-info").show();var a=1,b=trRenderSpeed;jQuery.each(ixmapsDataJson,function(c,d){setTimeout(function(){if(trRenderStop)return!1;showThisTr(c),jQuery("#tr-count").text(a),a++},b),b+=trRenderSpeed}),removeTr(),showTotalTrInfo()},removeAllTrs=function(){for(removeTr(),trsAddedToMap=[],skippedRouterNum=new Array(0,0,0,0),trRouterAdded=0,impDistLog="",ipCollection=new Object,jQuery("#map-impossible-distance-log").html(""),jQuery("#map-router-exclusion").html(""),jQuery("#map-loading-status").html(""),jQuery("#map-tr-active").html("");routeMarkers[0];)routeMarkers.pop().setMap(null);for(;trCollection[0];)trCollection.pop().setMap(null);for(;trOcollection[0];)trOcollection.pop().setMap(null);activeCarriers=new Object,showTotalTrInfo(),jQuery("#tr-count").text("0")},removeTr=function(){null!=activeTrObj&&activeTrObj.setMap(null)},excludeRouter=function(a,b,c,d){var e=!1;return excludeCoord0&&0==a.lat&&0==a.long&&(e=!0,1==d&&(skippedRouterNum[0]+=1)),excludeCoordGen&&config.genericLatLongs.includes(a.lat+", "+a.long)&&(e=!0,1==d&&(skippedRouterNum[1]+=1)),excludeReservedAS&&-1==a.asnum&&null==a.gl_override&&(e=!0,1==d&&(skippedRouterNum[3]+=1)),excludeUserFlagged&&1==a.flagged&&(e=!0,1==d&&(skippedRouterNum[4]+=1)),jQuery("#map-impossible-distance-log").html(impDistLog),e},renderTr=function(a){var a=a.toString(),b=null,c=[],d=[],e=!1,f=!1,g="";if(allowMultipleTrs||(skippedRouterNum=new Array(0,0,0,0,0),trRouterCount=0,trRouterAdded=0),-1!=trsAddedToMap.indexOf(a)?(f=!0,console.log("The TR ("+a+") is already in the map")):trsAddedToMap.push(a),!f){if(jQuery.each(ixmapsDataJson[a].hops,function(b,d){if(!(e=excludeRouter(d,a,d.hop,1))){var f=new Array(a,d.hop,d.lat,d.long,d.asnum,d.asname,d.ip_addr,d.gl_override,d.mm_city,d.mm_country,d.hostname);d.asnum in activeCarriers?activeCarriers[d.asnum][0]+=1:activeCarriers[d.asnum]=Array(1,d.asname,d.mm_country),c.push(f),trRouterAdded++}trRouterCount++}),1==c.length){console.log("TR with one hop Id:",c[0][0]);var h=new google.maps.LatLng(c[0][2],c[0][3]);d.push(h)}if(jQuery.each(c,function(e,f){if(showOriginMarker&&0==e){var g=new google.maps.LatLng(c[0][2],c[0][3]),h=new google.maps.Marker({position:g,map:map,title:"Origin of TRid: "+c[0][0]}),i=config.url_base+"/_assets/img/icn-gm-route-start.png";h.setIcon(i),h.setMap(map),routeMarkers.push(h)}if(showTerminationMarker&&e==c.length-1){var g=new google.maps.LatLng(c[c.length-1][2],c[c.length-1][3]),h=new google.maps.Marker({position:g,map:map,title:"Destination of TRid: "+c[0][0]}),i=config.url_base+"/_assets/img/icn-gm-route-end.png";h.setIcon(i),h.setMap(map),routeMarkers.push(h)}var j=getAsnColour([c[e][4]]),k=new google.maps.LatLng(c[e][2],c[e][3]),l=new google.maps.Marker({position:k,map:map,icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.6,fillColor:j,strokeWeight:0,scale:10}}),m=c[e][6];if(m in ipCollection?ipCollection[m]+=1:ipCollection[m]=1,google.maps.event.addListener(l,"click",function(){viewTrDetails(c[e][0])}),google.maps.event.addListener(l,"mouseover",function(){infowindowTimeout=setTimeout(function(){infowindow&&infowindow.close();var b=createMarkerText(a,c,e);infowindow=new google.maps.InfoWindow({content:b}),infowindow.open(map,l)},300)}),google.maps.event.addListener(l,"mouseout",function(){clearTimeout(infowindowTimeout)}),l.setMap(map),trOcollection.push(l),e>0){var n=[],o=new google.maps.LatLng(c[e-1][2],c[e-1][3]),p=new google.maps.LatLng(c[e][2],c[e][3]);n.push(o),n.push(p),d.push(o),d.push(p);var q=getAsnColour([c[e-1][4]]);b=null,b=new google.maps.Polyline({path:n,strokeColor:q,strokeOpacity:.6,strokeWeight:6}),google.maps.event.addListener(b,"click",function(){viewTrDetails(a)}),google.maps.event.addListener(b,"mouseover",function(){trHopMouseover(c[e-1][0],c[e-1][1],1)}),b.setMap(map),trCollection.push(b)}}),allowRecenter&&0!=d.length)if(1==d.length)map.setCenter(d[0]),map.setZoom(4);else{for(var i=new google.maps.LatLngBounds,j=0;j<d.length;j++)i.extend(d[j]);d.length=0,map.fitBounds(i)}}g+=f?"":"TR added",removeTr()},createMarkerText=function(a,b,c){infowindowRoute=b;var d=b[c],e=getPrivacyScore(d[4]),f="";e>0&&(f="<div>"+renderPrivacyScore(e)+"</div>");var g="",h="";return c>0&&(g='<button style="font-weight: bold;" onclick="openPreviousRouterMarker('+a+", "+c+')"> < </button>'),c+1<b.length&&(h='<button style="font-weight: bold;" onclick="openNextRouterMarker('+a+", "+c+')"> > </button>'),'<div class="router-infowindow"><div>'+g+'<span style="font-weight: bold;"> Router '+d[1]+" </span>"+h+'<button id="flag-it-btn" data-asn="'+d[0]+'" data-hop="'+d[1]+'" data-ip="'+d[6]+'" onclick="flagActiveRouter()"><span id="flag-btn-text">Flag router</span><img id="flag-btn-img" src="/_assets/img/icon-flag.png"/></button></div><div style="margin-top: 8px; font-weight: bold;">'+d[10]+'</div><div style="font-weight: bold"><span>'+d[8]+", "+d[9]+'</span><span style="float: right;">'+d[2]+", "+d[3]+'</span></div><div style="margin-bottom: 20px"><span>'+d[5]+'</span><span style="float: right;">'+f+'</span></div><div><a href="javascript:removeAllButThis('+a+');">Remove All but This Route</a></div><div><a href="javascript:viewTrDetails('+d[0]+');">View Details of This Route (Id '+d[0]+")</a></div></div>"},openNextRouterMarker=function(a,b){infowindow&&infowindow.close();var c=createMarkerText(a,infowindowRoute,b+1);infowindow=new google.maps.InfoWindow({content:c}),infowindow.open(map,trOcollection[b+1])},openPreviousRouterMarker=function(a,b){infowindow&&infowindow.close();var c=createMarkerText(a,infowindowRoute,b-1);infowindow=new google.maps.InfoWindow({content:c}),infowindow.open(map,trOcollection[b-1])},flagActiveRouter=function(){jQuery(".flagging.modal").modal("show");var a=jQuery("#flag-it-btn").data();showFlags(a.asn,a.hop,a.ip,!0)},setTRidActive=function(a){jQuery("#tr-a-"+a).toggleClass("tr-ids-active")},renderTr2=function(a){var b,c=[];jQuery.each(ixmapsDataJson[a].hops,function(d,e){if(!(b=excludeRouter(e,a,d,0))){var f=new google.maps.LatLng(e.lat,e.long);c.push(f)}}),null!=activeTrObj&&activeTrObj.setMap(null);var d=trCollection.length+1;activeTrObj=null;var e={path:"M 0,-0.5 0,0.5",strokeWeight:4,strokeOpacity:1,scale:3};activeTrObj=new google.maps.Polyline({path:c,strokeOpacity:0,strokeWeight:13,icons:[{icon:e,offset:"100%",repeat:"10px"}],zIndex:d}),google.maps.event.addListener(activeTrObj,"click",function(){viewTrDetails(a)}),activeTrObj.setMap(map)},newIpFlag=function(){jQuery("#ip-flags-data").hide()},saveIpFlag=function(){console.log("saving ip flag");for(var a="",b=1;b<7;b++){jQuery("#ip-t-"+b).is(":checked")&&(a+=jQuery("#ip-t-"+b).val()+",")}var c={action:"saveIpFlag",ip_addr_f:activeIpFlag,user_ip:myIp,user_nick:getPar("user_nick"),user_reasons_types:a,user_msg:getPar("user_msg"),ip_new_loc:getPar("ip_new_loc")};jQuery.ajax(config.url_base+"/application/controller/ip_flag.php",{type:"post",data:c,success:function(a){console.log("Ok! saveIpFlag"),jQuery(".flagging.modal").modal("hide"),jQuery.toast({heading:"Thank you for flagging this router",text:"We will review your suggestion and update our database accordingly. In the meantime, you can view traceroutes with flagged routers removed (these and other options are available through the Gear icon on the map)",hideAfter:1e4,allowToastClose:!0,position:"mid-center",icon:"success"}),1==a&&getIpFlags(!0)},error:function(a){console.log("Error! saveIpFlag",a)}})},getPar=function(a){return jQuery("#"+a).val()},getIpFlags=function(a){console.log("getting ip flags data");var b={action:"getIpFlag",ip_addr_f:activeIpFlag};jQuery.ajax(config.url_base+"/application/controller/ip_flag.php",{type:"post",data:b,success:function(b){console.log("Ok! getIpFlag");var c=jQuery.parseJSON(b);a?(jQuery("#ip-flags").show(),jQuery("#user_nick").val(""),jQuery("#ip_new_loc").val(""),jQuery("#user_msg").val(""),c.ip_flags?jQuery("#ip-flags-data").fadeIn("fast"):(jQuery("#ip-flags-data-list").html(""),jQuery("#ip-flags-data").hide()),renderIpFlagData(c)):renderIpFlagDataMouseOver(c)},error:function(a){console.log("Error! getIpFlag",a)}})},renderIpFlagDataMouseOver=function(a){console.log("renderIpFlagDataMouseOver")},renderIpFlagData=function(a){console.log("OK! renderIpFlagData");var b=a.ip_addr_info[0],c=b.mm_lat,d=b.mm_long,e=b.name,f="Unknown";b.mm_lat!==b.lat&&(c=b.lat),b.mm_long!==b.long&&(d=b.long),e.length>36&&(e=e.slice(0,36)+"..."),f=1==b.gl_override||2==b.gl_override?"Geolocation determined by hostname parsing methods":3==b.gl_override?"Geolocation determined by pre/post hop patterns and latency analysis":b.gl_override?"Geolocation determined by IXmaps internal methods":a.ip_flags?"Geolocation has been flagged as potentially inaccurate":"Geolocation determined by Maxmind",jQuery("#ip-flag-tr-id").text(activeTridFlag),jQuery("#ip-flag-router").text(activeHopNumFlag),jQuery("#ip-flag-ip-address").text(b.ip_addr),jQuery("#ip-flag-asn-name").text(e),jQuery("#ip-flag-hostname").text(b.hostname),jQuery("#ip-flag-star-rating").html(renderPrivacyScore(getPrivacyScore(b.num))),jQuery("#ip-flag-location").text(getCityRegionCountry(b.mm_city,b.mm_region,b.mm_country)),jQuery("#ip-flag-lat-long").text(c+", "+d),jQuery("#ip-flag-gl-override").text(f);var g="";a.ip_flags&&(g+='<table id="ip-flags-table" style="width: 100%;" class="tablesorter tr-list-result"><thead><tr><th>User</th><th>Date</th><th>Suggested Location</th><th>Comment</th></thead><tbody>',jQuery.each(a.ip_flags,function(a,b){g+="<tr><td>"+b.user_nick+"</td><td>"+b.date_f.slice(0,10)+"</td><td>"+b.ip_new_loc+"</td><td>"+b.user_msg+"</td></tr>"}),g+="</tbody></table>"),jQuery("#ip-flags-data-list").html(g),jQuery("#ip-flags-table").tablesorter({headers:{0:{sorter:!1},1:{sorter:!1},2:{sorter:!1},3:{sorter:!1}}})},activeIpFlag="",activeHopNumFlag="",activeTridFlag="",flagCounter=0,showFlags=function(a,b,c,d){activeIpFlag=c,activeTridFlag=a,activeHopNumFlag=b,console.log("ip: "+c+", trId: "+a+", hopH: "+b),console.log("Displaying Flag info for ip: "+activeIpFlag),d||jQuery("#flagging-info-m").html("Getting Flags..."),getIpFlags(d)},trHopMouseover=function(a,b,c){var d="",e="",f="";if(0==c)e="Router",d="<br/>IP: <strong>"+ixmapsDataJson[a].hops[b].ip_addr+"</strong>",d+=' | <span id="flag-this-link"></span>';else{e="Hop";var g=parseInt(b);g++,f="-"+g}var h=e+": <strong>"+b+f+"</strong><br/>Carrier: <strong>"+ixmapsDataJson[a].hops[b].asname+"</strong>, ASN: <strong>"+ixmapsDataJson[a].hops[b].asnum+"</strong>"+d;h+='<div id="flagging-info-m"></div>',jQuery("#map-info").html(h),activeTrId=a},removeAllButThis=function(a){removeTr(),removeAllTrs(),showThisTr(a)},viewPrivacy=function(a){var b="",c="",d=0;jQuery("#carrier-title").html("<h5>"+privacyData.scores[a][0].carrier_name+" (ASN: "+privacyData.scores[a][0].asn+")</h5>"),b+='<table id="privacy-details-table">',b+="<tr><td> </td><td><b>Criteria</b></td><td><b>Score</b></td></tr>",jQuery("#privacy-details").fadeIn("slow"),jQuery.each(privacyData.scores[a],function(a,e){var f=parseFloat(e.score);d+=f;var g=""+e.score;f>0&&(g='<span class="privacy-score-col-non-zero">'+e.score+"</span>"),c="<b>"+privacyData.stars[e.star_id].star_short_name+"</b> ",c+=""+privacyData.stars[e.star_id].star_long_des,b+="<tr><td>"+e.star_id+"</td><td>"+c+'</td><td class="privacy-score-col">'+g+"</td></tr>"}),b+="<tr><td></td>",b+="<td>",b+='<div id="privacy-feedback-info"><a class="link" target="_new" href="'+privacyRepUrl+'">View the full transparency report</a></div>',b+='<div id="privacy-total-label"><b>Total Score </b></div>',b+="</td>",b+='<td class="privacy-score-col"><span class="privacy-score-col-total">'+d+"</span></td>",b+="</tr>",b+="</table>",jQuery("#privacy-details-data").html(b),setTimeout(function(){jQuery(".carrier.modal").modal("show")},200)},buildTrSummaryTable=function(){jQuery("#traceroutes-results-table tbody").empty(),jQuery.each(ixmapsDataJson,function(a,b){var c=b.metadata,d=jQuery("<td />").text(c.first_hop_country+" "+c.first_hop_city);null!=c.first_hop_country&&(d=jQuery(d).prepend(jQuery("<i />").addClass("flag "+c.first_hop_country.toLowerCase())));var e='<a id="tr-a-'+a+'" class="link" href="javascript: showThisTr('+a+');" onmouseout="removeTr()" onmouseover="renderTr2('+a+')" onfocus="showThisTr('+a+')">'+a+"</a>";jQuery("#traceroutes-results-table tbody").prepend(jQuery("<tr />").append(jQuery(d),jQuery("<td />").text(c.dest_hostname),jQuery("<td />").append(e)))}),jQuery("#traceroutes-results-table").tablesorter()},viewTrDetails=function(a){jQuery("#tr-details-modal .tr-metadata-more-details tbody").empty(),jQuery("#tr-details-modal .traceroute-container tbody").empty(),jQuery("#tr-details-modal .traceroute-container-more-details tbody").empty();var b=ixmapsDataJson[a].metadata,c=b.sub_time.split(".")[0],d=null===b.submitter_zip_code?"Not specified":b.submitter_zip_code;jQuery("#tr-details-modal .tr-metadata-container .tr-id").text(a),jQuery("#tr-details-modal .tr-metadata-container .submitter").text(b.submitter),jQuery("#tr-details-modal .tr-metadata-container .sub-time").text(c),jQuery("#tr-details-modal .tr-metadata-container .zip-code").text(d),jQuery("#tr-details-modal .tr-metadata-container .destination").text(b.dest_hostname),jQuery("#tr-details-modal .tr-metadata-container .dest-ip").text(" - "+b.dest_ip_addr),jQuery("#tr-details-modal .tr-metadata-container .terminated").text("(did not terminate)"),"t"==b.terminated&&jQuery("#tr-details-modal .tr-metadata-container .terminated").text("(terminated)"),jQuery("#tr-details-modal .tr-metadata-more-details tbody").append(jQuery("<tr />").append(jQuery("<td />").text("Origin").css("font-weight","bold"),jQuery("<td />").text(b.origin_asnum?b.origin_asnum:""),jQuery("<td />").text(b.origin_asname?b.origin_asname:""),jQuery("<td />").text(b.origin_city?b.origin_city:""),jQuery("<td />").text(b.origin_country?b.origin_country:"")),jQuery("<tr />").append(jQuery("<td />").text("Last hop").css("font-weight","bold"),jQuery("<td />").text(b.last_hop_asnum?b.last_hop_asnum:""),jQuery("<td />").text(b.last_hop_asname?b.last_hop_asname:""),jQuery("<td />").text(b.last_hop_city?b.last_hop_city:""),jQuery("<td />").text(b.last_hop_country?b.last_hop_country:"")),jQuery("<tr />").append(jQuery("<td />").text("Destination").css("font-weight","bold"),jQuery("<td />").text(b.dest_asnum?b.dest_asnum:""),jQuery("<td />").text(b.dest_asname?b.dest_asname:""),jQuery("<td />").text(b.dest_city?b.dest_city:""),jQuery("<td />").text(b.dest_country?b.dest_country:""))),jQuery.each(ixmapsDataJson[a].hops,function(a,b){var c=jQuery("<td />").text(b.mm_city?b.mm_city:"");null!=b.mm_country&&(c=jQuery(c).prepend(jQuery("<i />").addClass("flag "+b.mm_country.toLowerCase()))),jQuery("#tr-details-modal .traceroute-container tbody").append(jQuery("<tr />").append(jQuery("<td />").text(b.hop),jQuery("<td />").text(b.min_latency).addClass("latencies-cell"),jQuery(c),jQuery("<td />").css("background",getAsnBackground(b.asnum)).text(b.asname?b.asname:""))),jQuery("#tr-details-modal .traceroute-container-more-details tbody").append(jQuery("<tr />").append(jQuery("<td />").text(b.hop),jQuery("<td />").text(b.ip_addr),jQuery("<td />").text(b.hostname),jQuery("<td />").text(b.asnum),jQuery("<td />").text(b.rtt1+"|"+b.rtt2+"|"+b.rtt3+"|"+b.rtt4),jQuery("<td />").text(b.lat),jQuery("<td />").text(b.long),jQuery("<td />").text(b.gl_override?b.gl_override:"")))}),jQuery("#tr-details-modal").modal("show")},getCityRegionCountry=function(a,b,c){var d="",e=[],f=!0;return a&&a.length>0&&e.push(a),b&&b.length>0&&e.push(b),c&&c.length>0&&e.push(c),e.forEach(function(a){f?(d+=a,f=!1):d+=", "+a}),d},toggleMap=function(){jQuery("#map-container").toggle(),jQuery("#map-canvas-container").toggle(),jQuery("#tr-list-ids").toggle()},setShowNsa=function(){showNsa?(showNsa=!1,removeGeoMarkers(1),jQuery("#map-show-nsa").removeClass("map-tool-on").addClass("map-tool-off")):(showNsa=!0,renderGeoMarkers(1),jQuery("#map-show-nsa").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowNsa",showNsa)},setShowHotel=function(){showHotel?(showHotel=!1,removeGeoMarkers(2),jQuery("#map-show-hotel").removeClass("map-tool-on").addClass("map-tool-off")):(showHotel=!0,renderGeoMarkers(2),jQuery("#map-show-hotel").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowHotel",showHotel)},setShowGoogle=function(){showGoogle?(showGoogle=!1,removeGeoMarkers(3),jQuery("#map-show-google").removeClass("map-tool-on").addClass("map-tool-off")):(showGoogle=!0,renderGeoMarkers(3),jQuery("#map-show-google").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowGoogle",showGoogle)},setShowUc=function(){showUc?(showUc=!1,removeGeoMarkers(4),jQuery("#map-show-uc").removeClass("map-tool-on").addClass("map-tool-off")):(showUc=!0,renderGeoMarkers(4),jQuery("#map-show-uc").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowUc",showUc)},setShowIXca=function(){showIXca?(showIXca=!1,removeGeoMarkers(5),jQuery("#map-show-IXca").removeClass("map-tool-on").addClass("map-tool-off")):(showIXca=!0,renderGeoMarkers(5),jQuery("#map-show-IXca").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowIXca",showIXca)},setShowCiraIPT=function(){showCiraIPT?(showCiraIPT=!1,removeGeoMarkers(6),jQuery("#map-show-CiraIPT").removeClass("map-tool-on").addClass("map-tool-off")):(showCiraIPT=!0,renderGeoMarkers(6),jQuery("#map-show-CiraIPT").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowCiraIPT",showCiraIPT)},setShowAtt=function(){showAtt?(showAtt=!1,removeGeoMarkers(7),jQuery("#map-show-Att").removeClass("map-tool-on").addClass("map-tool-off")):(showAtt=!0,renderGeoMarkers(7),jQuery("#map-show-Att").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowAtt",showAtt)},setShowVerizon=function(){showVerizon?(showVerizon=!1,removeGeoMarkers(8),jQuery("#map-show-Verizon").removeClass("map-tool-on").addClass("map-tool-off")):(showVerizon=!0,renderGeoMarkers(8),jQuery("#map-show-Verizon").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowVerizon",showVerizon)},setShowGoogleTo=function(){showGoogleTO?(showGoogleTO=!1,removeGeoMarkers(9),jQuery("#map-show-google-to").removeClass("map-tool-on").addClass("map-tool-off")):(showGoogleTO=!0,renderGeoMarkers(9),jQuery("#map-show-google-to").removeClass("map-tool-off").addClass("map-tool-on")),console.log("setShowGoogleTo",showGoogleTO)},setDefaultMapSettings=function(){allowMultipleTrs=!1,jQuery("#map-allow-multiple").removeClass("map-tool-on").addClass("map-tool-off"),excludeReservedAS=!1,jQuery("#map-exclude-d").removeClass("map-tool-on").addClass("map-tool-off")},setAllowMultipleTrs=function(){allowMultipleTrs?(allowMultipleTrs=!1,jQuery("#map-allow-multiple").removeClass("map-tool-on").addClass("map-tool-off"),jQuery("#map-action-remove-all-but-this").hide()):(allowMultipleTrs=!0,jQuery("#map-allow-multiple").removeClass("map-tool-off").addClass("map-tool-on"),jQuery("#map-action-remove-all-but-this").show())},setAllowRecenter=function(){allowRecenter?(allowRecenter=!1,jQuery("#map-allow-recenter").removeClass("map-tool-on").addClass("map-tool-off")):(allowRecenter=!0,jQuery("#map-allow-recenter").removeClass("map-tool-off").addClass("map-tool-on"))},setOriginMarker=function(){showOriginMarker?(showOriginMarker=!1,jQuery("#map-origin-marker").removeClass("map-tool-on").addClass("map-tool-off")):(showOriginMarker=!0,jQuery("#map-origin-marker").removeClass("map-tool-off").addClass("map-tool-on"))},setTerminationMarker=function(){showTerminationMarker?(showTerminationMarker=!1,jQuery("#map-termination-marker").removeClass("map-tool-on").addClass("map-tool-off")):(showTerminationMarker=!0,jQuery("#map-termination-marker").removeClass("map-tool-off").addClass("map-tool-on"))},excludeA=function(){excludeCoord0?(excludeCoord0=!1,jQuery("#map-exclude-a").removeClass("map-tool-on").addClass("map-tool-off")):(excludeCoord0=!0,jQuery("#map-exclude-a").removeClass("map-tool-off").addClass("map-tool-on"))},excludeB=function(){excludeCoordGen?(excludeCoordGen=!1,jQuery("#map-exclude-b").removeClass("map-tool-on").addClass("map-tool-off")):(excludeCoordGen=!0,jQuery("#map-exclude-b").removeClass("map-tool-off").addClass("map-tool-on"))},excludeC=function(){excludeImpDist?(excludeImpDist=!1,jQuery("#map-exclude-c").removeClass("map-tool-on").addClass("map-tool-off")):(excludeImpDist=!0,jQuery("#map-exclude-c").removeClass("map-tool-off").addClass("map-tool-on")),alert("Note that this option is functional but it has not been fully tested.")},excludeD=function(){excludeReservedAS?(excludeReservedAS=!1,jQuery("#map-exclude-d").removeClass("map-tool-on").addClass("map-tool-off")):(excludeReservedAS=!0,jQuery("#map-exclude-d").removeClass("map-tool-off").addClass("map-tool-on"))},excludeE=function(){excludeUserFlagged?(excludeUserFlagged=!1,jQuery("#map-exclude-e").removeClass("map-tool-on").addClass("map-tool-off")):(excludeUserFlagged=!0,jQuery("#map-exclude-e").removeClass("map-tool-off").addClass("map-tool-on"))},renderGeoMarkers=function(a){jQuery.each(cHotelData,function(b,c){var d;1==a&&"NSA"==c.type&&(d=createGmMarker(c),gmNsa.push(d),d.setMap(map)),2==a&&"CH"==c.type&&(d=createGmMarker(c),gmHotel.push(d),d.setMap(map)),3==a&&"Google"==c.type&&(d=createGmMarker(c),gmGoogle.push(d),d.setMap(map)),4==a&&"UC"==c.type&&(d=createGmMarker(c),gmUc.push(d),d.setMap(map)),5==a&&"IXca"==c.type&&(d=createGmMarker(c),gmIXca.push(d),d.setMap(map)),6==a&&"CIRA_IPT"==c.type&&(d=createGmMarker(c),gmCiraIPT.push(d),d.setMap(map)),7==a&&"AT&T"==c.type&&(d=createGmMarker(c),gmAtt.push(d),d.setMap(map)),8==a&&"Verizon"==c.type&&(d=createGmMarker(c),gmVerizon.push(d),d.setMap(map)),9==a&&"GoogleTo"==c.type&&(d=createGmMarker(c),gmGoogleTO.push(d),d.setMap(map))})},removeGeoMarkers=function(a){if(1==a)for(;gmNsa[0];)gmNsa.pop().setMap(null);else if(2==a)for(;gmHotel[0];)gmHotel.pop().setMap(null);else if(3==a)for(;gmGoogle[0];)gmGoogle.pop().setMap(null);else if(4==a)for(;gmUc[0];)gmUc.pop().setMap(null);else if(5==a)for(;gmIXca[0];)gmIXca.pop().setMap(null);else if(6==a)for(;gmCiraIPT[0];)gmCiraIPT.pop().setMap(null);else if(7==a)for(;gmAtt[0];)gmAtt.pop().setMap(null);else if(8==a)for(;gmVerizon[0];)gmVerizon.pop().setMap(null);else if(9==a)for(;gmGoogleTO[0];)gmGoogleTO.pop().setMap(null)},createGmMarker=function(a){var b=new google.maps.LatLng(a.lat,a.long),c=new google.maps.Marker({position:b,map:map}),d="";"NSA"==a.type&&"A"==a.nsa?d=config.url_base+"/_assets/img/icn-map-nsa-class-A.png":"NSA"==a.type&&"A"!=a.nsa?d=config.url_base+"/_assets/img/icn-map-nsa-class-med.png":"CH"==a.type?d=config.url_base+"/_assets/img/icn-map-carrier.png":"UC"==a.type?d=config.url_base+"/_assets/img/icn-map-undersea.png":"Google"==a.type||"GoogleTo"==a.type?d=config.url_base+"/_assets/img/icn-map-google.png":"IXca"==a.type?d=config.url_base+"/_assets/img/icn-map-ixp.png":"CIRA_IPT"==a.type?d=config.url_base+"/_assets/img/icn-map-ipt.png":"AT&T"==a.type?d=config.url_base+"/_assets/img/icn-map-att.png":"Verizon"==a.type&&(d=config.url_base+"/_assets/img/icn-map-verizon.png"),c.setIcon(d);var e='<span class="geoitem-layer-name">'+a.layer_name+"</span>";e+="<br/><b>"+a.address+"</b>",""!=a.image&&(e+='<br/><img src="'+a.image+'" width="100px"/></a>'),""!=a.ch_operator&&(e+="<br/>Operator: <b>"+a.ch_operator+"</b>"),""!=a.ch_build_owner?e+="<br/>Building Owner: <b>"+a.ch_build_owner+"</b>":""!=a.ch_build_owner&&""!=a.ch_build_owner_src&&(e+='<br/>Building Owner: <a href="'+a.ch_build_owner+'"></a>'),""!=a.isp_src&&(e+='<br/><a href="'+a.isp_src+'" target="_blank">ISP</a>'),""!=a.nsa_src&&(e+='<br/><a href="'+a.nsa_src+'" target="_blank">NSA Source</a>');var f=new google.maps.InfoWindow({content:e});return google.maps.event.addListener(c,"click",function(){f.open(map,c)}),c},getPrivacyReport=function(){console.log("Loading PrivacyReport data");var a={action:"getPrivacyReport"};jQuery.ajax(config.url_base+"/application/controller/privacy_report.php",{type:"post",data:a,success:function(a){console.log("getPrivacyReport success"),privacyData=jQuery.parseJSON(a)},error:function(a){console.log("getPrivacyReport error: ",a)}})},getPrivacyScore=function(a){var b=0;return privacyData.scores[a]&&jQuery.each(privacyData.scores[a],function(a,c){var d=parseFloat(c.score);b+=d}),b},renderPrivacyScore=function(a){var b=0,c=0,d=parseFloat(a);b=parseInt(a),c=a-b;var e="";if(b>=1)for(var f=0;f<b;f++)e+='<img src="'+config.url_base+'/_assets/img/star-a-4.png" class="privacy-star-img">';return 0==d&&(e+='<img src="'+config.url_base+'/_assets/img/star-a-0.png" class="privacy-star-img">'),c>0&&c<=.5&&(e+='<img src="'+config.url_base+'/_assets/img/star-a-2.png" class="privacy-star-img">'),e},asnColours='{"174":"rgb(228,49,235)","3356":"rgb(235,114,49)","7018":"rgb(66,237,234)","7132":"rgb(66,237,234)","-1":"rgb(103,106,107)","577":"rgb(61,73,235)","1239":"rgb(236,242,68)","6461":"rgb(227,174,235)","6327":"rgb(156,104,70)","6453":"rgb(103,106,107)","3561":"rgb(103,106,107)","812":"rgb(237,9,36)","20453":"rgb(237,9,36)","852":"rgb(75,230,37)","13768":"rgb(65,156,107)","3257":"rgb(103,106,107)","1299":"rgb(103,106,107)","22822":"rgb(103,106,107)","6939":"rgb(103,106,107)","376":"rgb(103,106,107)","32613":"rgb(103,106,107)","6539":"rgb(61,73,235)","15290":"rgb(103,106,107)","5769":"rgb(103,106,107)","855":"rgb(103,106,107)","26677":"rgb(103,106,107)","271":"rgb(103,106,107)","6509":"rgb(103,106,107)","3320":"rgb(103,106,107)","23498":"rgb(103,106,107)","549":"rgb(103,106,107)","239":"rgb(103,106,107)","11260":"rgb(103,106,107)","1257":"rgb(103,106,107)","20940":"rgb(103,106,107)","23136":"rgb(103,106,107)","5645":"rgb(103,106,107)","21949":"rgb(103,106,107)","8111":"rgb(103,106,107)","13826":"rgb(103,106,107)","16580":"rgb(103,106,107)","9498":"rgb(103,106,107)","802":"rgb(103,106,107)","19752":"rgb(103,106,107)","11854":"rgb(103,106,107)","7992":"rgb(103,106,107)","17001":"rgb(103,106,107)","611":"rgb(103,106,107)","19080":"rgb(103,106,107)","26788":"rgb(103,106,107)","12021":"rgb(103,106,107)","33554":"rgb(103,106,107)","30528":"rgb(103,106,107)","16462":"rgb(103,106,107)","11700":"rgb(103,106,107)","14472":"rgb(103,106,107)","13601":"rgb(103,106,107)","11032":"rgb(103,106,107)","12093":"rgb(103,106,107)","10533":"rgb(103,106,107)","26071":"rgb(103,106,107)","32156":"rgb(103,106,107)","5764":"rgb(103,106,107)","27168":"rgb(103,106,107)","33361":"rgb(103,106,107)","32489":"rgb(103,106,107)","15296":"rgb(103,106,107)","10400":"rgb(103,106,107)","10965":"rgb(103,106,107)","18650":"rgb(103,106,107)","36522":"rgb(103,106,107)","19086":"rgb(103,106,107)"}',asnColoursJson=jQuery.parseJSON(asnColours),getAsnColour=function(a){var b="rgb(153, 153, 153)";return void 0!==asnColoursJson[a]&&(b=asnColoursJson[a]),b},getAsnBackground=function(a){return c=getAsnColour(a),c=c.replace("rgb","rgba"),c=c.replace(")",", 0.8)"),c};